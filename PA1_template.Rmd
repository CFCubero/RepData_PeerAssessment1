
setwd("D:/1. Cursos/Data Science/Modulo 5. Reproducible Research/Week2/Project 1")
library(lubridate)

#General options
```{r setoptions}
opts_chunk$set(echo=TRUE)
```

1. Loading and preprocessing the data

```{r load}
data<-read.csv("activity.csv")
data$date<-as.Date(data$date)
```

2. What is mean total number of steps taken per day?

```{r steps_daily}
sum_steps_d<-sapply(split(data,as.factor(data$date)),function(x) sum(x$steps,na.rm=T))
hist(sum_steps_d,
	xlab="number of daily steps",
	ylab="number of days",
	labels=T,
	main="histogram of number of steps per day",
	col="blue")
mean_steps<-mean(sum_steps_d)
median_steps<-median(sum_steps_d)
cat("mean of the total number of steps taken per day:\n");mean_steps
cat("median of the total number of steps taken per day:\n");median_steps
```

3. What is the average daily activity pattern?

```{r steps_interval}
ave_steps_i<-sapply(split(data,as.factor(data$interval)),function(x) mean(x$steps,na.rm=T))
plot(ave_steps_i,type="l",
	xlab="daily interval",
	ylab="average of number of steps",
	col="purple",
	lwd=8)

max_i<-ave_steps_i[ave_steps_i==max(ave_steps_i)]
cat("5 min interval with the maximum number of steps is:\n");names(max_i)
cat("5 min interval with the maximum number of steps is:\n");cat(names(max_i));cat("\n")
```

4. Imputing missing values

```{r nas}
cat("The number of NAs on each variable is the following\n");apply(data,2,function(x) sum(is.na(x)))

#NA imputation
cat("NA imputation\n")
ave_steps_i<-sapply(split(data,as.factor(data$interval)),function(x) mean(x$steps,na.rm=T))
data[is.na(data$steps),]$steps<-ave_steps_i[data[is.na(data$steps),]$interval]
cat("The number of NAs on each variable is now\n");apply(data,2,function(x) sum(is.na(x)))

#Recalculation of point 1 without NAs
cat("Recalculations of point 2, histogram of total number of steps per day, mean and median but now without NAs\n")
sum_steps_d<-sapply(split(data,as.factor(data$date)),function(x) sum(x$steps,na.rm=T))
hist(sum_steps_d,
	xlab="number of daily steps",
	ylab="number of days",
	labels=T,
	main="histogram of number of steps per day",
	col="blue")
mean_steps<-mean(sum_steps_d)
median_steps<-median(sum_steps_d)
cat("mean of the total number of steps taken per day:\n");mean_steps
cat("median of the total number of steps taken per day:\n");median_steps
```

##New values differs from the calculated on point 2.
##Number of steps per days is greater than in point 2

5. Are there differences in activity patterns between weekdays and weekends?

```{r weekends}
#Creation of a variable differentiation weekday and weekday

data$day_type<-"weekday"
data$day_type[weekdays(data$date)%in%weekdays(as.Date(c("2012-12-02","2012-12-01")))]<-"weekend"

#Average number of steps per interval depending on weekday/weekend
ave_steps_i_wd<-sapply(split(data[data$day_type=="weekday",],as.factor(data$interval)),function(x) mean(x$steps,na.rm=T))
ave_steps_i_we<-sapply(split(data[data$day_type=="weekend",],as.factor(data$interval)),function(x) mean(x$steps,na.rm=T))
ave_steps_i_dt<-data.frame(ave_wd=ave_steps_i_wd,ave_we=ave_steps_i_we)

#plot
par(mfrow=c(2,1))
with(ave_steps_i_dt,{
plot(ave_steps_i_dt$ave_wd,type="l",
	xlab="daily interval",
	ylab="average of number of steps",
	col="purple",
	main="weekday",
	lwd=4)
plot(ave_steps_i_dt$ave_we,type="l",
	xlab="daily interval",
	ylab="average of number of steps",
	col="purple",
	main="weekend",
	lwd=4)
})
```

